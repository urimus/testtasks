

<!DOCTYPE html>

<html>

<head>
<title>Urmas Repinski - Тестовое Задание</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="google-site-verification" content="v6u7i24jgVhRRKYDwtq6zl5T86g4v9C7nzJ_UYw1LiU" />


<style>
.title_blue {
	background-color: #448CCB; background: linear-gradient(0deg, rgba(71,141,203,1) 25%, rgba(130,188,228,1) 75%);
	font-size: 14px; font-family: "Verdana"; color:#ffffff;  font-weight:bold; text-align:center; height:20px; width:100%;
}
</style>

</head>

<body style="background: #FFFFFF url('../icons/background/brick_wall.jpg');  background-attachment: fixed;" >

<!-- Header Image Table -->
<table cellspacing="0" cellpadding="0" width="1000" align="center" border="0">
        <tr> 
                <td  height="3"></td>
        </tr>   
        <tr>
                <td width="1000">
                        <img src="../icons/urmas.jpg" alt="Я" title="Я"  width="1000" style="display: block">
                </td>
        </tr>


</table>




<!-- Main Table -->
<table cellspacing="0" cellpadding="0" border="0"  width="1000" align="center">
        <tr> 

		<td width="827" valign="top" align="center" bgcolor="#d0e7f7" height="100%"> <!-- Functional Table -->

<form action = "" method="post" name="form">


<table cellspacing="0" cellpadding="0" width="100%" border="0" bgcolor="#d0e7f7">
<!-- Table where search, name and languages and func area-->
<tr><td>


<table cellspacing="0" cellpadding="0" width="100%" border="0" bgcolor="#d0e7f7">
<!-- Table with search, name and languages -->
        <tr> 
                <td  class="title_blue" style="width: 530px;"><a name="welcome">Urmas Repinski - Тестовое Задание</a></td>
        </tr>

        <tr>
                <td height="3" bgcolor="#ff8a00"></td>
        </tr>   

</table>


<!-- For scroll inside div 550 -->
<div id="scrollDiv" style="height:621px;overflow:auto;">

<table cellspacing="2" cellpadding="0" width="100%">

        <tr align="center" >
			<td width="25%" valign="top" style = "border: #84bde4 1px solid;  background-color: #d0e7f7">
				<table id="menuTable"><tr><td>Loading .... </td></tr></table>
			</td>
			<td bgcolor="#d0e7f7" valign="top" align="center" >&hairsp;</td>
			<td  width="75%" style = "border: #84bde4 1px solid;  background-color: #d0e7f7">
				<table id="descTable"></table>
			</td>

                </tr>

  </table> <!-- End of Func area -->

</div> <!-- End of scroll inside div -->


  </td></tr>
  </table>
</form> 
    </td>
        </tr>   
</table> <!-- End of Main Table -->

<!-- Bottom Copyright Table --> 
<table cellspacing="0" cellpadding="0" width="1000"  align="center" border="0">
  <tr>
    <td height="3" bgcolor="#ff8a00"></td>
  </tr>
        <tr>
          <td class="title_blue" >
            &copy; Urmas Repinski, urrimus@hotmail.com
          </td>
        </tr>
</table>
<!-- End of Bottom Copyright Table --> 



<script>


lastSelectedId=-1;



function escapeHtml(unsafe) {
    return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
 }



	function submitReview() {

		const promise1 = new Promise((resolve, reject) => {
		setTimeout(() => {
			resolve("review");
		}, 1000);
		});

		promise1.then((value) => {

			username=document.getElementById("username").value;
			email=document.getElementById("email").value;
			review=document.getElementById("review").value;

			if (username=="" && email=="") {alert("Username and Email are required."); return;}
			if (username=="") {alert("Username is required."); return;}
			if (email=="") {alert("Email is required."); return;}


			 const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			if(!re.test(email)) {alert("Enter valid email."); return;}

			table=document.getElementById("formTable");
			while(table.childNodes.length>0){table.removeChild(table.lastChild);}

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='<b>Congratulations! Wizard is Complete!</b>';

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Data You Entered:';

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Username: '+escapeHtml(username);

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Email: '+escapeHtml(email);

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Review: '+escapeHtml(review);

  		});


	}

	function outputFilm(data) {
		if (data.episode_id==lastSelectedId) { // to avoid unactual states
			table=document.getElementById("descTable");
			while(table.childNodes.length>0){table.removeChild(table.lastChild);}

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Title: '+data.title;

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Episode nr: '+data.episode_id;

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Opening Crawl: '+data.opening_crawl;

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='<table id="formTable"></table>';


			table=document.getElementById("formTable");
			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Username*: <input type=“text” id="username"/>';

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Email*: <input type=“email” id="email"/>';

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='Review: <textarea id="review"></textarea>';

			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='<button type="button" id="submit" onclick="submitReview();">Send</button> ';

		}

	}

	function fetchFilm(episodeNr, episodeId) {

		// to avoid unactual states
		lastSelectedId=episodeId;
		table=document.getElementById("descTable");
		while(table.childNodes.length>0){table.removeChild(table.lastChild);}

		var tableRow = table.insertRow(-1);
		var cell1=tableRow.insertCell(0);
		cell1.innerHTML='Loading .... ';

		fetch('https://swapi.dev/api/films/'+episodeNr)
		.then(response => response.json())
		.then(data => outputFilm(data));
	}


	function outputMenu(data) {
		table=document.getElementById("menuTable");
		while(table.childNodes.length>0){table.removeChild(table.lastChild);}

		for(var i = 0; i < data.results.length; i++ ) {
			var tableRow = table.insertRow(-1);
			var cell1=tableRow.insertCell(0);
			cell1.innerHTML='<a href="javascript:fetchFilm('+(i+1)+','+data.results[i].episode_id+')">'+data.results[i].title+'</a>';
		}

	}





	fetch('https://swapi.dev/api/films/')
	.then(response => response.json())
	.then(data => outputMenu(data));


                  


</script>


</body>
</html>



